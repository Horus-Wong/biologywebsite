<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蟾蜍捕食者游戏</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gameBrown: '#8B4513',
                        gameWhite: '#F5F5F5',
                        gameGreen: '#228B22',
                        gameBlack: '#222222',
                    },
                    fontFamily: {
                        game: ['Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .toad-shadow {
                filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.3));
            }
            .btn-hover {
                @apply transition-all duration-300 hover:scale-105 active:scale-95;
            }
            .toad-transition {
                @apply transition-all duration-500 ease-out;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-game flex flex-col items-center p-4">
    <!-- 游戏容器 -->
    <div class="max-w-5xl w-full bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- 游戏标题 -->
        <header class="bg-gradient-to-r from-emerald-600 to-emerald-800 text-white p-6 text-center">
            <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-bold tracking-wide">蟾蜍捕食者游戏</h1>
            <p class="mt-2 text-emerald-100">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;探索保护色在自然选择中的作用&nbsp; &nbsp; &nbsp; &nbsp;交大附中东校区20250911</p>
        </header>
        
        <!-- 游戏开始界面 -->
        <div id="startScreen" class="p-8 text-center">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">选择背景环境</h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-gameBlack text-white p-4 rounded-lg cursor-pointer hover:ring-4 hover:ring-black transition-all" data-bg="black">
                    <p class="font-medium">黑色背景</p>
                </div>
                <div class="bg-gameWhite text-gray-800 p-4 rounded-lg border border-gray-300 cursor-pointer hover:ring-4 hover:ring-gray-300 transition-all" data-bg="white">
                    <p class="font-medium">白色背景</p>
                </div>
                <div class="bg-gameBrown text-white p-4 rounded-lg cursor-pointer hover:ring-4 hover:ring-gameBrown transition-all" data-bg="brown">
                    <p class="font-medium">褐色背景</p>
                </div>
                <div class="bg-gameGreen text-white p-4 rounded-lg cursor-pointer hover:ring-4 hover:ring-gameGreen transition-all" data-bg="green">
                    <p class="font-medium">绿色背景</p>
                </div>
            </div>
            
            <button id="startBtn" class="bg-emerald-600 text-white px-8 py-3 rounded-full text-lg font-medium btn-hover opacity-50 cursor-not-allowed" disabled="">
                开始游戏 <i class="fa fa-play ml-2"></i>
            </button>
        </div>
        
        <!-- 游戏界面 (初始隐藏) -->
        <div id="gameScreen" class="hidden">
            <!-- 游戏信息栏 -->
            <div class="bg-gray-800 text-white p-3 flex justify-between items-center">
                <div>
                    <span class="font-medium">当前轮次: </span>
                    <span id="currentRound" class="bg-emerald-600 px-2 py-1 rounded text-sm">1</span>
                </div>
                <button id="changeImageBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded text-sm btn-hover">
                    换图 <i class="fa fa-picture-o ml-1"></i>
                </button>
                <button id="restartBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded text-sm btn-hover">
                    重新开始 <i class="fa fa-refresh ml-1"></i>
                </button>
            </div>
            
            <!-- 游戏区域 -->
            <div id="gameArea" class="relative w-full aspect-video overflow-hidden">
                <!-- 蟾蜍将在这里动态生成 -->
            </div>
            
        </div>
        
        <!-- 游戏结束界面 (初始隐藏) -->
        <div id="endScreen" class="hidden p-8 text-center">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">游戏结束!</h2>
            <p id="endMessage" class="text-lg text-gray-600 mb-6">恭喜你完成了所有4轮游戏!</p>
            
            <div class="mb-8 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-gray-800 mb-2">最终蟾蜍数量</h3>
                <div id="finalCounts" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                    <!-- 最终数量将在这里动态生成 -->
                </div>
            </div>
            
            <button id="playAgainBtn" class="bg-emerald-600 text-white px-8 py-3 rounded-full text-lg font-medium btn-hover">
                再玩一次 <i class="fa fa-refresh ml-2"></i>
            </button>
        </div>
    </div>
    
    <!-- 游戏说明 -->
    <div class="mt-6 max-w-5xl w-full bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold text-gray-800 mb-2">游戏说明</h3>
        <ul class="text-gray-600 text-sm space-y-1 list-disc list-inside">
            <li>1、选择一种背景环境，然后点击开始游戏</li>
            <li>2、点击界面上的蟾蜍进行捕食，每次捕食后其余蟾蜍会重新分布</li>
            <li>3、当蟾蜍数量减少到10只时，它们会繁殖到40只</li>
            <li>4、游戏共有4轮繁殖，完成后游戏结束</li>
            <li>5、点击"换图"按钮可以尝试加载图片替代圆点</li>
            <li>6、观察哪种颜色的蟾蜍更容易生存下来，理解保护色的作用</li>
        </ul>
    </div>

    <script>
        // 游戏状态变量
        const gameState = {
            background: null,
            toads: [],
            counts: {
                black: 10,
                white: 10,
                brown: 10,
                green: 10
            },
            round: 1,
            isPlaying: false,
            useImages: false, // 用于控制是否使用图片，默认不使用
            toadSize: 50 // 蟾蜍大小设置为50px
        };
        
        // DOM 元素
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const endScreen = document.getElementById('endScreen');
        const gameArea = document.getElementById('gameArea');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const changeImageBtn = document.getElementById('changeImageBtn');
        const currentRoundEl = document.getElementById('currentRound');
        const backgroundOptions = document.querySelectorAll('[data-bg]');
        
        // 初始化背景选择
        backgroundOptions.forEach(option => {
            option.addEventListener('click', () => {
                // 移除所有选中状态
                backgroundOptions.forEach(opt => opt.classList.remove('ring-4', 'ring-offset-2'));
                
                // 添加当前选中状态
                option.classList.add('ring-4', 'ring-offset-2');
                
                // 设置选中的背景
                gameState.background = option.dataset.bg;
                
                // 启用开始按钮
                startBtn.disabled = false;
                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            });
        });
        
        // 开始游戏
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', restartGame);
        playAgainBtn.addEventListener('click', restartGame);
        changeImageBtn.addEventListener('click', toggleToadDisplay);
        
        // 切换蟾蜍显示方式（圆点/图片）
        function toggleToadDisplay() {
            // 如果当前是圆点显示，尝试切换到图片显示
            if (!gameState.useImages) {
                // 先标记为使用图片
                gameState.useImages = true;
                
                // 检查图片是否存在的方法
                function checkImageExists(src) {
                    return new Promise((resolve) => {
                        const img = new Image();
                        img.onload = () => resolve(true);
                        img.onerror = () => resolve(false);
                        img.src = src;
                    });
                }
                
                // 检查所有需要的图片
                const imageSources = ['褐.png', '白.png', '绿.png', '黑.png'];
                Promise.all(imageSources.map(src => checkImageExists(src)))
                    .then(results => {
                        const allImagesExist = results.every(exists => exists);
                        
                        if (allImagesExist) {
                            // 所有图片都存在，重新生成蟾蜍显示图片
                            initializeToads();
                            showNotification("已切换为图片显示");
                        } else {
                            // 有图片不存在，回退到圆点显示
                            gameState.useImages = false;
                            showNotification("图片文件不存在，继续使用圆点显示");
                        }
                    });
            } else {
                // 当前是图片显示，切换回圆点显示
                gameState.useImages = false;
                initializeToads();
                showNotification("已切换为圆点显示");
            }
        }
        
        // 开始游戏函数
        function startGame() {
            if (!gameState.background) return;
            
            // 设置游戏区域背景
            setGameBackground(gameState.background);
            
            // 隐藏开始界面，显示游戏界面
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            // 初始化蟾蜍（默认使用圆点）
            initializeToads();
            
            // 设置游戏状态
            gameState.isPlaying = true;
        }
        
        // 设置游戏背景
        function setGameBackground(color) {
            switch(color) {
                case 'black':
                    gameArea.className = 'relative w-full aspect-video overflow-hidden bg-gameBlack';
                    break;
                case 'white':
                    gameArea.className = 'relative w-full aspect-video overflow-hidden bg-gameWhite';
                    break;
                case 'brown':
                    gameArea.className = 'relative w-full aspect-video overflow-hidden bg-gameBrown';
                    break;
                case 'green':
                    gameArea.className = 'relative w-full aspect-video overflow-hidden bg-gameGreen';
                    break;
            }
        }
        
        // 初始化蟾蜍
        function initializeToads() {
            // 清空游戏区域
            gameArea.innerHTML = '';
            gameState.toads = [];
            
            // 创建每种颜色的蟾蜍
            ['black', 'white', 'brown', 'green'].forEach(color => {
                for (let i = 0; i < gameState.counts[color]; i++) {
                    createToad(color);
                }
            });
        }
        
        // 创建单个蟾蜍
        function createToad(color) {
            // 创建蟾蜍元素
            const toad = document.createElement('div');
            toad.className = `absolute toad-transition cursor-pointer toad-shadow`;
            
            // 根据状态决定使用图片还是圆点
            if (gameState.useImages) {
                // 使用图片显示
                const chineseNames = {
                    'black': '黑',
                    'white': '白',
                    'brown': '褐',
                    'green': '绿'
                };
                const imagePath = `${chineseNames[color]}.png`;
                
                // 创建图片元素，设置为50px大小
                const img = document.createElement('img');
                img.src = imagePath;
                img.alt = `${color}蟾蜍`;
                img.style.width = `${gameState.toadSize}px`;
                img.style.height = `${gameState.toadSize}px`;
                img.className = 'object-contain';
                
                // 图片加载失败时回退到圆点
                img.onerror = () => {
                    toad.innerHTML = '';
                    setToadAsCircle(toad, color);
                };
                
                toad.appendChild(img);
            } else {
                // 默认使用圆点显示
                setToadAsCircle(toad, color);
            }
            
            toad.dataset.color = color;
            
            // 随机位置
            positionToadRandomly(toad);
            
            // 添加点击事件（捕食）
            toad.addEventListener('click', () => {
                if (!gameState.isPlaying) return;
                
                // 移除被点击的蟾蜍
                捕食蟾蜍(toad, color);
            });
            
            // 添加到游戏区域和游戏状态
            gameArea.appendChild(toad);
            gameState.toads.push(toad);
        }
        
        // 将蟾蜍设置为圆点样式（50px大小）
        function setToadAsCircle(toad, color) {
            toad.style.width = `${gameState.toadSize}px`;
            toad.style.height = `${gameState.toadSize}px`;
            toad.className = `absolute rounded-full toad-shadow cursor-pointer toad-transition`;
            
            switch(color) {
                case 'black':
                    toad.classList.add('bg-gameBlack');
                    break;
                case 'white':
                    toad.classList.add('bg-gameWhite', 'border', 'border-gray-300');
                    break;
                case 'brown':
                    toad.classList.add('bg-gameBrown');
                    break;
                case 'green':
                    toad.classList.add('bg-gameGreen');
                    break;
            }
        }
        
        // 随机定位蟾蜍（考虑50px大小，防止超出边界）
        function positionToadRandomly(toad) {
            const gameAreaRect = gameArea.getBoundingClientRect();
            const maxLeft = gameAreaRect.width - gameState.toadSize;
            const maxTop = gameAreaRect.height - gameState.toadSize;
            
            const left = Math.floor(Math.random() * maxLeft);
            const top = Math.floor(Math.random() * maxTop);
            
            toad.style.left = `${left}px`;
            toad.style.top = `${top}px`;
        }
        
        // 重新分布所有剩余蟾蜍
        function redistributeToads() {
            gameState.toads.forEach(toad => {
                // 添加轻微的缩放动画，让重新分布更明显
                toad.classList.add('scale-75');
                setTimeout(() => {
                    positionToadRandomly(toad);
                    toad.classList.remove('scale-75');
                }, 200);
            });
        }
        
        // 捕食蟾蜍
        function 捕食蟾蜍(toad, color) {
            // 从DOM和游戏状态中移除蟾蜍
            toad.classList.add('scale-0');
            setTimeout(() => {
                toad.remove();
                const index = gameState.toads.indexOf(toad);
                if (index > -1) {
                    gameState.toads.splice(index, 1);
                }
                
                // 重新分布剩余蟾蜍
                redistributeToads();
            }, 300);
            
            // 减少计数
            gameState.counts[color]--;
            
            // 检查是否需要繁殖
            checkReproduction();
        }
        
        // 检查是否需要繁殖
        function checkReproduction() {
            const total = Object.values(gameState.counts).reduce((a, b) => a + b, 0);
            
            if (total <= 10) {
                // 繁殖：每种蟾蜍数量变为原来的3倍，总数量恢复到40左右
                reproduceToads();
                
                // 检查是否完成所有轮次
                if (gameState.round >= 4) {
                    endGame();
                } else {
                    // 进入下一轮
                    gameState.round++;
                    currentRoundEl.textContent = gameState.round;
                    
                    // 显示轮次变化提示
                    showRoundNotification();
                }
            }
        }
        
        // 蟾蜍繁殖
        function reproduceToads() {
            // 保存当前比例
            const total = Object.values(gameState.counts).reduce((a, b) => a + b, 0);
            
            // 计算繁殖后的数量（保持比例，总数约40）
            Object.keys(gameState.counts).forEach(color => {
                if (total > 0) {
                    const ratio = gameState.counts[color] / total;
                    gameState.counts[color] = Math.round(ratio * 40);
                } else {
                    // 如果所有蟾蜍都被捕食，重新初始化
                    gameState.counts[color] = 10;
                }
            });
            
            // 确保总数为40（处理四舍五入误差）
            const newTotal = Object.values(gameState.counts).reduce((a, b) => a + b, 0);
            const difference = 40 - newTotal;
            if (difference !== 0) {
                // 调整第一个有数量的蟾蜍
                for (const color of Object.keys(gameState.counts)) {
                    if (gameState.counts[color] > 0) {
                        gameState.counts[color] += difference;
                        break;
                    }
                }
            }
            
            // 重新生成蟾蜍
            initializeToads();
            
            // 显示繁殖提示
            showNotification(`第${gameState.round}轮繁殖完成！蟾蜍数量恢复到40只`);
        }
        
        // 显示轮次通知
        function showRoundNotification() {
            showNotification(`进入第${gameState.round}轮`);
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-emerald-600 text-white px-6 py-3 rounded-full shadow-lg z-50 opacity-0 transition-opacity duration-300';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 显示通知
            setTimeout(() => {
                notification.classList.replace('opacity-0', 'opacity-100');
            }, 100);
            
            // 隐藏通知
            setTimeout(() => {
                notification.classList.replace('opacity-100', 'opacity-0');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 2000);
        }
        
        // 结束游戏
        function endGame() {
            gameState.isPlaying = false;
            
            // 显示结束界面
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            
            // 更新最终计数
            const finalCounts = document.getElementById('finalCounts');
            finalCounts.innerHTML = '';
            
            const colors = [
                {name: '黑色', class: 'bg-gameBlack', key: 'black'},
                {name: '白色', class: 'bg-gameWhite border border-gray-300', key: 'white'},
                {name: '褐色', class: 'bg-gameBrown', key: 'brown'},
                {name: '绿色', class: 'bg-gameGreen', key: 'green'}
            ];
            
            colors.forEach(color => {
                const countEl = document.createElement('div');
                countEl.className = 'flex items-center justify-center p-2 bg-gray-100 rounded-lg';
                countEl.innerHTML = `
                    <div class="w-4 h-4 rounded-full ${color.class} mr-2"></div>
                    <span>${color.name}: <span class="font-medium">${gameState.counts[color.key]}</span></span>
                `;
                finalCounts.appendChild(countEl);
            });
            
            // 根据结果显示不同的消息
            const dominantColor = Object.keys(gameState.counts).reduce((a, b) => 
                gameState.counts[a] > gameState.counts[b] ? a : b
            );
            
            const colorNames = {
                black: '黑色',
                white: '白色',
                brown: '褐色',
                green: '绿色'
            };
            
            document.getElementById('endMessage').textContent = 
                `经过4轮捕食，${colorNames[dominantColor]}蟾蜍的数量最多，` +
                `说明与${colorNames[gameState.background]}背景相似的保护色更有利于生存！`;
        }
        
        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            gameState.counts = {
                black: 10,
                white: 10,
                brown: 10,
                green: 10
            };
            gameState.round = 1;
            gameState.isPlaying = false;
            gameState.useImages = false; // 重置为默认的圆点显示
            
            // 更新界面
            currentRoundEl.textContent = '1';
            
            // 隐藏游戏和结束界面，显示开始界面
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            
            // 重置背景选择
            backgroundOptions.forEach(opt => opt.classList.remove('ring-4', 'ring-offset-2'));
            
            // 禁用开始按钮
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    </script>


    </body></html>